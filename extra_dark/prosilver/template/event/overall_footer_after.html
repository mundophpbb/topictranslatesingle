<div class="gtranslate-footer-credit">
    <a href="https://gtranslate.io" target="_blank" rel="nofollow" class="gt-badge">
        <span class="gt-text">{{ lang('TOPIC_TRANSLATE_POWERED') }} </span>
        <span style="margin-left: 5px; font-weight: bold; font-size: 14px;">
            <span class="gt-g">G</span><span class="gt-o1">o</span><span class="gt-o2">o</span><span class="gt-g">g</span><span class="gt-l">l</span><span class="gt-e">e</span>
            <span style="color: #676767;">Translate</span>
        </span>
    </a>
</div>

<div class="gtranslate_wrapper"></div>

<script>
    // Configuração separada por linhas para melhor leitura e manutenção
    window.gtranslateSettings = {
        "default_language": "{{ GTRANSLATE_DEFAULT_LANGUAGE|default('en') }}",
        "languages": {{ GTRANSLATE_LANGUAGES_JSON|raw|default('["en"]') }},
        "wrapper_selector": ".gtranslate_wrapper",
        "flag_size": 16,
        "switcher_horizontal_position": "inline",
        "flag_style": "3d",
        "switcher_text_color": "#f7f7f7",
        "switcher_arrow_color": "#f2f2f2",
        "switcher_border_color": "#161616",
        "switcher_background_color": "#303030",
        "switcher_background_shadow_color": "#474747",
        "switcher_background_hover_color": "#3a3a3a",
        "dropdown_text_color": "#eaeaea",
        "dropdown_hover_color": "#748393",
        "dropdown_background_color": "#474747"
    };

    // Fallback e Lógica de ativação (mantendo o que já funciona)
    if (!Array.isArray(window.gtranslateSettings.languages) || window.gtranslateSettings.languages.length === 0) {
        window.gtranslateSettings.languages = ["en"];
    }

    function fixTranslationLayout() {
        document.querySelectorAll('.post-content-area.translate').forEach(area => {
            area.querySelectorAll('font, span').forEach(f => {
                if (f.innerText.trim().length > 0) {
                    f.style.display = "inline-block";
                    f.style.width = "100%";
                    f.style.marginBottom = "5px";
                }
            });
        });
    }

    const translationObserver = new MutationObserver(() => fixTranslationLayout());
    translationObserver.observe(document.body, { childList: true, subtree: true, characterData: true });

    let fixInterval = null;
    function startFixRetry() {
        if (fixInterval) clearInterval(fixInterval);
        fixTranslationLayout();
        fixInterval = setInterval(fixTranslationLayout, 800);
        setTimeout(() => { if (fixInterval) clearInterval(fixInterval); }, 10000);
    }

    function limparCookiesGTranslate() {
        const domains = [window.location.hostname, "." + window.location.hostname, document.domain];
        domains.forEach(domain => {
            document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=" + domain + ";";
            document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
        });
    }

    function resetarTradutor(btn) {
        limparCookiesGTranslate();
        if (fixInterval) clearInterval(fixInterval);
        const defaultLang = window.gtranslateSettings.default_language;
        const resetValue = defaultLang + '|' + defaultLang;
        const selector = document.querySelector('select.gt_selector');
        if (selector) {
            selector.value = resetValue;
            selector.dispatchEvent(new Event('change'));
            if (typeof doGTranslate === 'function') doGTranslate(resetValue);
        } else {
            location.reload();
        }
        document.querySelectorAll('.post-content-area').forEach(area => {
            area.classList.replace('translate', 'notranslate');
        });
        document.querySelectorAll('.gtranslate_wrapper').forEach(el => el.style.display = 'none');
    }

    function abrirTradutor(btn) {
        limparCookiesGTranslate();
        document.querySelectorAll('.gtranslate_wrapper').forEach(el => el.style.display = 'none');
        document.querySelectorAll('.post-content-area').forEach(area => {
            area.classList.add('notranslate');
            area.classList.remove('translate');
        });
        const wrapper = btn.parentNode.querySelector('.gtranslate_wrapper');
        const postArea = btn.closest('.postbody').querySelector('.post-content-area');
        if (wrapper) {
            wrapper.style.display = 'block';
            wrapper.onclick = () => setTimeout(() => { wrapper.style.display = 'none'; }, 1500);
            startFixRetry();
        }
        if (postArea) {
            postArea.classList.remove('notranslate');
            postArea.classList.add('translate');
            startFixRetry();
        }
    }
</script>
<script src="https://cdn.gtranslate.net/widgets/latest/dwf.js" defer></script>