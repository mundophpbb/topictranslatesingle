<div class="gtranslate-footer-credit">
    <a href="https://gtranslate.io" target="_blank" rel="nofollow" class="gt-badge">
        <span class="gt-text">{{ lang('TOPIC_TRANSLATE_POWERED') }} </span>
        <span style="margin-left: 5px; font-weight: bold; font-size: 14px; text-decoration: none;">
            <span class="gt-g">G</span><span class="gt-o1">o</span><span class="gt-o2">o</span><span class="gt-g">g</span><span class="gt-l">l</span><span class="gt-e">e</span>
            <span style="color: #676767;">Translate</span>
        </span>
    </a>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

    // Adiciona o label "{L_TRANSLATE}" apenas uma vez
    document.querySelectorAll(".gtranslate_wrapper").forEach(wrapper => {
        if (!wrapper.querySelector(".gt_label_translate")) {
            const first = wrapper.querySelector("a, li, div, select");
            if (first) {
                const tag = first.tagName.toLowerCase();
                const label = document.createElement(tag);
                label.textContent = "{L_TRANSLATE}";
                label.className = "gt_label_translate gt-box";
                wrapper.insertBefore(label, wrapper.firstChild);
            }
        }
    });

    // FECHAR MENU AO CLICAR FORA
    document.addEventListener("click", (e) => {
        document.querySelectorAll(".gtranslate_wrapper").forEach(wrapper => {
            const isInside = wrapper.contains(e.target);
            const isButton = e.target.closest(".btn-translate-custom");

            if (!isInside && !isButton) {
                wrapper.style.display = "none";
            }
        });
    });

});

window.gtranslateSettings = {
    "default_language": "{{ GTRANSLATE_DEFAULT_LANGUAGE|default('en') }}",
    "native_language_names": {{ GTRANSLATE_NATIVE_NAMES ? 'true' : 'false' }},
    "detect_browser_language": {{ GTRANSLATE_DETECT_BROWSER ? 'true' : 'false' }},
    "languages": {{ GTRANSLATE_LANGUAGES_JSON|raw|default('["en"]') }},
    "wrapper_selector": ".gtranslate_wrapper",
    "flag_size": 16,
    "switcher_horizontal_position": "inline",
    "flag_style": "3d"
};

function limparCookiesGTranslate() {
    const domains = [window.location.hostname, "." + window.location.hostname, document.domain];
    domains.forEach(domain => {
        document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/; domain=" + domain + ";";
        document.cookie = "googtrans=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    });
}

function resetarTradutor(btn) {
    limparCookiesGTranslate();
    const defaultLang = window.gtranslateSettings.default_language;
    const resetValue = defaultLang + "|" + defaultLang;
    const selector = document.querySelector("select.gt_selector");

    if (selector) {
        selector.value = resetValue;
        selector.dispatchEvent(new Event("change"));
        if (typeof doGTranslate === "function") doGTranslate(resetValue);
    } else {
        location.reload();
    }

    document.querySelectorAll(".post-content-area").forEach(area => {
        area.classList.remove("translate");
        area.classList.add("notranslate");
    });

    document.querySelectorAll(".gtranslate_wrapper").forEach(el => {
        el.style.display = "none";
    });
}

function abrirTradutor(btn) {
    limparCookiesGTranslate();

    // Fecha outros menus
    document.querySelectorAll(".gtranslate_wrapper").forEach(el => {
        el.style.display = "none";
    });

    const wrapper = btn.parentNode.querySelector(".gtranslate_wrapper");
    const postArea = btn.closest(".postbody").querySelector(".post-content-area");

    if (wrapper) {
        wrapper.style.display = "block";

        const selector = wrapper.querySelector("select.gt_selector");

        // FECHAR AO ESCOLHER IDIOMA
        if (selector) {
            selector.addEventListener("input", () => {
                wrapper.style.display = "none";
            }, { once: true });
        }
    }

    if (postArea) {
        postArea.classList.remove("notranslate");
        postArea.classList.add("translate");
    }
}
</script>

<script src="https://cdn.gtranslate.net/widgets/latest/dwf.js" defer></script>